<UserControl x:Class="DatabaseMigrationTool.Views.ConnectionStringControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             x:Name="ConnectionControl"
             d:DesignHeight="300" d:DesignWidth="400">
    <Grid Margin="5">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Connection Profiles -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="Profile:" Margin="0,0,10,0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" x:Name="ProfileComboBox" Margin="0,5" 
                     SelectionChanged="ProfileComboBox_SelectionChanged"
                     ToolTip="Select a saved connection profile">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding Provider}" Foreground="Gray" Margin="0,0,5,0"/>
                            <TextBlock Text="-" Foreground="Gray" Margin="0,0,5,0"/>
                            <TextBlock Text="{Binding Server}" Foreground="Gray"/>
                        </StackPanel>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
            <Button Grid.Column="2" Content="ðŸ’¾" Margin="5,5,2,5" Padding="8,2" Click="SaveProfile_Click"
                   ToolTip="Save current connection as profile" FontSize="14"/>
            <Button Grid.Column="3" Content="ðŸ“‹" Margin="2,5,0,5" Padding="8,2" Click="ManageProfiles_Click"
                   ToolTip="Manage connection profiles" FontSize="14"/>
        </Grid>

        <!-- Connection type selection -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>
            
            <TextBlock Grid.Column="0" Text="Provider:" Margin="0,0,10,0" VerticalAlignment="Center"/>
            <ComboBox Grid.Column="1" x:Name="ProviderComboBox" SelectedIndex="{Binding ProviderIndex, ElementName=ConnectionControl, Mode=TwoWay}" Margin="0,5" SelectionChanged="ProviderComboBox_SelectionChanged">
                <ComboBoxItem Content="SQL Server"/>
                <ComboBoxItem Content="MySQL"/>
                <ComboBoxItem Content="PostgreSQL"/>
                <ComboBoxItem Content="Firebird"/>
            </ComboBox>
        </Grid>

        <!-- Connection details card -->
        <Border Grid.Row="2" Background="White" BorderBrush="#DDDDDD" BorderThickness="1" Margin="0,5,0,0" Padding="10">
            <Grid>
                <Grid x:Name="SqlServerPanel">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- SQL Server settings -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Server:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" x:Name="SqlServerServerTextBox" Margin="0,5" Text="{Binding SqlServerServer, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Server name or IP address (e.g., localhost, 192.168.1.100\SQLEXPRESS)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Database:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="1" x:Name="SqlServerDatabaseTextBox" Margin="0,5" Text="{Binding SqlServerDatabase, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                             ToolTip="Database name (leave blank to connect to server only)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Authentication:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,5">
                        <RadioButton x:Name="SqlServerWindowsAuthRadioButton" Content="Windows Authentication" IsChecked="True" Margin="0,0,10,0" Checked="SqlServerAuthType_Changed"/>
                        <RadioButton x:Name="SqlServerSqlAuthRadioButton" Content="SQL Server Authentication" Checked="SqlServerAuthType_Changed"/>
                    </StackPanel>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Username:" Margin="0,5,10,5" VerticalAlignment="Center"
                              IsEnabled="{Binding IsChecked, ElementName=SqlServerSqlAuthRadioButton}"/>
                    <TextBox Grid.Row="3" Grid.Column="1" x:Name="SqlServerUsernameTextBox" Margin="0,5" 
                            IsEnabled="{Binding IsChecked, ElementName=SqlServerSqlAuthRadioButton}" 
                            Text="{Binding SqlServerUsername, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Password:" Margin="0,5,10,5" VerticalAlignment="Center"
                              IsEnabled="{Binding IsChecked, ElementName=SqlServerSqlAuthRadioButton}"/>
                    <PasswordBox Grid.Row="4" Grid.Column="1" x:Name="SqlServerPasswordBox" Margin="0,5"
                                IsEnabled="{Binding IsChecked, ElementName=SqlServerSqlAuthRadioButton}"
                                PasswordChanged="SqlServerPasswordBox_PasswordChanged"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Trust Server Certificate:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <CheckBox Grid.Row="5" Grid.Column="1" x:Name="SqlServerTrustCertCheckBox" Margin="0,5" IsChecked="True"
                             Content="Trust server certificate" Checked="ConnectionField_TextChanged" Unchecked="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Additional Parameters:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="6" Grid.Column="1" x:Name="SqlServerAdditionalParamsTextBox" Margin="0,5"
                            Text="{Binding SqlServerAdditionalParams, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Additional connection string parameters (e.g., Timeout=30;Encrypt=False)" TextChanged="ConnectionField_TextChanged"/>
                </Grid>

                <Grid x:Name="MySqlPanel" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- MySQL settings -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Server:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" x:Name="MySqlServerTextBox" Margin="0,5"
                            Text="{Binding MySqlServer, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Server name or IP address (e.g., localhost, 192.168.1.100)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="1" x:Name="MySqlPortTextBox" Margin="0,5"
                            Text="{Binding MySqlPort, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="MySQL server port (default: 3306)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Database:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="1" x:Name="MySqlDatabaseTextBox" Margin="0,5"
                            Text="{Binding MySqlDatabase, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Database name" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Username:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="3" Grid.Column="1" x:Name="MySqlUsernameTextBox" Margin="0,5"
                            Text="{Binding MySqlUsername, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="MySQL username (e.g., root)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Password:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <PasswordBox Grid.Row="4" Grid.Column="1" x:Name="MySqlPasswordBox" Margin="0,5"
                                PasswordChanged="MySqlPasswordBox_PasswordChanged"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Use SSL:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <CheckBox Grid.Row="5" Grid.Column="1" x:Name="MySqlSslCheckBox" Margin="0,5"
                              Content="Use SSL/TLS for connection" Checked="ConnectionField_TextChanged" Unchecked="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Additional Parameters:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="6" Grid.Column="1" x:Name="MySqlAdditionalParamsTextBox" Margin="0,5"
                            Text="{Binding MySqlAdditionalParams, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Additional connection string parameters (e.g., CharSet=utf8mb4)" TextChanged="ConnectionField_TextChanged"/>
                </Grid>

                <Grid x:Name="PostgreSqlPanel" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- PostgreSQL settings -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Host:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="0" Grid.Column="1" x:Name="PostgreSqlHostTextBox" Margin="0,5"
                            Text="{Binding PostgreSqlHost, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Host name or IP address (e.g., localhost, 192.168.1.100)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Port:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="1" Grid.Column="1" x:Name="PostgreSqlPortTextBox" Margin="0,5"
                            Text="{Binding PostgreSqlPort, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="PostgreSQL server port (default: 5432)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Database:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="2" Grid.Column="1" x:Name="PostgreSqlDatabaseTextBox" Margin="0,5"
                            Text="{Binding PostgreSqlDatabase, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Database name" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Username:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="3" Grid.Column="1" x:Name="PostgreSqlUsernameTextBox" Margin="0,5"
                            Text="{Binding PostgreSqlUsername, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="PostgreSQL username (e.g., postgres)" TextChanged="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Password:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <PasswordBox Grid.Row="4" Grid.Column="1" x:Name="PostgreSqlPasswordBox" Margin="0,5"
                                PasswordChanged="PostgreSqlPasswordBox_PasswordChanged"/>

                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Use SSL:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <CheckBox Grid.Row="5" Grid.Column="1" x:Name="PostgreSqlSslCheckBox" Margin="0,5" IsChecked="True"
                              Content="Use SSL/TLS for connection" Checked="ConnectionField_TextChanged" Unchecked="ConnectionField_TextChanged"/>

                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Additional Parameters:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="6" Grid.Column="1" x:Name="PostgreSqlAdditionalParamsTextBox" Margin="0,5"
                            Text="{Binding PostgreSqlAdditionalParams, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Additional connection string parameters" TextChanged="ConnectionField_TextChanged"/>
                </Grid>
                
                <Grid x:Name="FirebirdPanel" Visibility="Collapsed">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Firebird settings -->
                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Database File:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <Grid Grid.Row="0" Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" x:Name="FirebirdDatabaseFileTextBox" Margin="0,5"
                                Text="{Binding FirebirdDatabaseFile, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                                ToolTip="Full path to the Firebird database file" TextChanged="ConnectionField_TextChanged"/>
                        <Button Grid.Column="1" Content="Browse..." Margin="5,5,0,5" Padding="10,0" Click="BrowseFirebirdFile_Click"/>
                    </Grid>
                    
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Username:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <Grid Grid.Row="1" Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0" x:Name="FirebirdUsernameTextBox" Margin="0,5,5,5"
                                Text="{Binding FirebirdUsername, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                                ToolTip="Firebird username (default: SYSDB)" TextChanged="ConnectionField_TextChanged"
                                IsEnabled="{Binding IsChecked, ElementName=FirebirdUsernameOverrideCheckBox}"/>
                        <CheckBox Grid.Column="1" x:Name="FirebirdUsernameOverrideCheckBox" Margin="5,5,0,5"
                                 Content="Override" VerticalAlignment="Center"
                                 ToolTip="Check to override default username" IsChecked="False"
                                 Checked="FirebirdUsernameOverride_Changed" Unchecked="FirebirdUsernameOverride_Changed"/>
                    </Grid>

                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Password:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <Grid Grid.Row="2" Grid.Column="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <PasswordBox Grid.Column="0" x:Name="FirebirdPasswordBox" Margin="0,5,5,5"
                                    PasswordChanged="FirebirdPasswordBox_PasswordChanged"
                                    IsEnabled="{Binding IsChecked, ElementName=FirebirdPasswordOverrideCheckBox}"/>
                        <CheckBox Grid.Column="1" x:Name="FirebirdPasswordOverrideCheckBox" Margin="5,5,0,5"
                                 Content="Override" VerticalAlignment="Center"
                                 ToolTip="Check to override default password" IsChecked="False"
                                 Checked="FirebirdPasswordOverride_Changed" Unchecked="FirebirdPasswordOverride_Changed"/>
                    </Grid>

                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Firebird Version:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <ComboBox Grid.Row="3" Grid.Column="1" x:Name="FirebirdFormatComboBox" Margin="0,5" SelectedIndex="1" SelectionChanged="FirebirdFormat_Changed"
                             ToolTip="Select the Firebird database version - this determines which client library is used">
                        <ComboBoxItem Content="Firebird 5.0 / 4.0 / 3.0+" Tag="5.0"/>
                        <ComboBoxItem Content="Firebird 2.5" Tag="2.5"/>
                    </ComboBox>

                    <TextBlock Grid.Row="4" Grid.Column="0" Text="Additional Options:" Margin="0,5,10,5" VerticalAlignment="Center"/>
                    <TextBox Grid.Row="4" Grid.Column="1" x:Name="FirebirdAdditionalOptionsTextBox" Margin="0,5"
                            Text="{Binding FirebirdAdditionalOptions, ElementName=ConnectionControl, UpdateSourceTrigger=PropertyChanged}"
                            ToolTip="Additional Firebird connection options" TextChanged="ConnectionField_TextChanged"/>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</UserControl>