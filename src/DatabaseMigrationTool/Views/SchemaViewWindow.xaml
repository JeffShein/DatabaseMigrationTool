<Window x:Class="DatabaseMigrationTool.Views.SchemaViewWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DatabaseMigrationTool.Views"
        xmlns:System="clr-namespace:System;assembly=mscorlib"
        mc:Ignorable="d"
        Title="Database Schema" Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <Border Grid.Row="0" Background="#0078D7" Padding="15">
            <TextBlock x:Name="SchemaHeaderTextBlock" Text="Database Schema" FontSize="22" FontWeight="SemiBold" Foreground="White" />
        </Border>
        
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Table List -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBox Grid.Row="0" Margin="10,10,10,5" x:Name="FilterTextBox" 
                             ToolTip="Filter tables"
                             TextChanged="FilterTextBox_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Style.Resources>
                                    <VisualBrush x:Key="HintBrush" TileMode="None" Opacity="0.5" Stretch="None" AlignmentX="Left">
                                        <VisualBrush.Visual>
                                            <TextBlock Text="Filter tables..." FontStyle="Italic" />
                                        </VisualBrush.Visual>
                                    </VisualBrush>
                                </Style.Resources>
                                <Style.Triggers>
                                    <Trigger Property="Text" Value="{x:Static System:String.Empty}">
                                        <Setter Property="Background" Value="{StaticResource HintBrush}" />
                                    </Trigger>
                                    <Trigger Property="Text" Value="{x:Null}">
                                        <Setter Property="Background" Value="{StaticResource HintBrush}" />
                                    </Trigger>
                                    <Trigger Property="IsKeyboardFocused" Value="True">
                                        <Setter Property="Background" Value="White" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <ListBox Grid.Row="1" Margin="10,5,10,10" x:Name="TablesListBox"
                             DisplayMemberPath="FullName"
                             SelectionChanged="TablesListBox_SelectionChanged"/>
                </Grid>
            </Border>

            <!-- Table Details -->
            <Grid Grid.Column="1">
                <ScrollViewer>
                    <StackPanel Margin="15" x:Name="TableDetailsPanel">
                        <TextBlock Text="Select a table to view its schema" FontSize="16" Foreground="Gray"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,50,0,0"
                                   x:Name="NoSelectionTextBlock"/>
                        
                        <Grid x:Name="TableDetailsGrid" Visibility="Collapsed">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Table Name -->
                            <StackPanel Grid.Row="0" Orientation="Vertical" Margin="0,0,0,15">
                                <TextBlock x:Name="TableNameTextBlock" Text="Table Name" FontSize="18" FontWeight="Bold"/>
                                <TextBlock x:Name="TableSchemaTextBlock" Text="Schema" FontSize="12" Foreground="Gray"/>
                            </StackPanel>

                            <!-- Tabs for different aspects -->
                            <TabControl Grid.Row="1" Margin="0,10,0,0">
                                <!-- Columns Tab -->
                                <TabItem Header="Columns">
                                    <DataGrid x:Name="ColumnsDataGrid" AutoGenerateColumns="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                                              BorderThickness="0" Margin="0,10,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="150"/>
                                            <DataGridTextColumn Header="Data Type" Binding="{Binding DataType}" Width="100"/>
                                            <DataGridTextColumn Header="Nullable" Binding="{Binding IsNullable}" Width="60"/>
                                            <DataGridTextColumn Header="Default" Binding="{Binding DefaultValue}" Width="100"/>
                                            <DataGridTextColumn Header="PK" Binding="{Binding IsPrimaryKey}" Width="40"/>
                                            <DataGridTextColumn Header="Position" Binding="{Binding OrdinalPosition}" Width="60"/>
                                            <DataGridTextColumn Header="Max Length" Binding="{Binding MaxLength}" Width="80"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </TabItem>
                                
                                <!-- Indexes Tab -->
                                <TabItem Header="Indexes">
                                    <DataGrid x:Name="IndexesDataGrid" AutoGenerateColumns="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                                              BorderThickness="0" Margin="0,10,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200"/>
                                            <DataGridTextColumn Header="Columns" Binding="{Binding ColumnsDisplay}" Width="200"/>
                                            <DataGridTextColumn Header="Is Unique" Binding="{Binding IsUnique}" Width="80"/>
                                            <DataGridTextColumn Header="Type" Binding="{Binding IndexType}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </TabItem>
                                
                                <!-- Foreign Keys Tab -->
                                <TabItem Header="Foreign Keys">
                                    <DataGrid x:Name="ForeignKeysDataGrid" AutoGenerateColumns="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                                              BorderThickness="0" Margin="0,10,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200"/>
                                            <DataGridTextColumn Header="Columns" Binding="{Binding ColumnsDisplay}" Width="150"/>
                                            <DataGridTextColumn Header="References" Binding="{Binding ReferencedTableDisplay}" Width="150"/>
                                            <DataGridTextColumn Header="Ref. Columns" Binding="{Binding ReferencedColumnsDisplay}" Width="150"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </TabItem>
                                
                                <!-- Constraints Tab -->
                                <TabItem Header="Constraints">
                                    <DataGrid x:Name="ConstraintsDataGrid" AutoGenerateColumns="False" IsReadOnly="True"
                                              GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                                              BorderThickness="0" Margin="0,10,0,0">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200"/>
                                            <DataGridTextColumn Header="Type" Binding="{Binding ConstraintType}" Width="100"/>
                                            <DataGridTextColumn Header="Definition" Binding="{Binding Definition}" Width="300"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </TabItem>
                                
                                <!-- Statistics Tab -->
                                <TabItem Header="Table Statistics">
                                    <Grid Margin="0,10,0,0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Grid.Row="0" Text="Loading statistics..." x:Name="StatsLoadingTextBlock"/>
                                        
                                        <Grid Grid.Row="1" Margin="0,10,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <!-- Record count removed due to permission issues -->
                                            
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Estimated Size:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="1" Grid.Column="1" x:Name="TableSizeTextBlock" Text="-" Margin="0,0,0,5"/>
                                            
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Average Row Size:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="AvgRowSizeTextBlock" Text="-" Margin="0,0,0,5"/>
                                            
                                            <TextBlock Grid.Row="3" Grid.Column="0" Text="Last Modified:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="3" Grid.Column="1" x:Name="LastModifiedTextBlock" Text="-" Margin="0,0,0,5"/>
                                            
                                            <TextBlock Grid.Row="4" Grid.Column="0" Text="Table Type:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="4" Grid.Column="1" x:Name="TableTypeTextBlock" Text="-" Margin="0,0,0,5"/>
                                        </Grid>
                                        
                                        <TextBlock Grid.Row="2" Margin="0,15,0,5" FontWeight="Bold" Text="Storage Information"/>
                                        
                                        <Grid Grid.Row="3" Margin="0,5,0,0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <TextBlock Grid.Row="0" Grid.Column="0" Text="Page Count:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="0" Grid.Column="1" x:Name="PageCountTextBlock" Text="-" Margin="0,0,0,5"/>
                                            
                                            <TextBlock Grid.Row="1" Grid.Column="0" Text="Fill Factor:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="1" Grid.Column="1" x:Name="FillFactorTextBlock" Text="-" Margin="0,0,0,5"/>
                                            
                                            <TextBlock Grid.Row="2" Grid.Column="0" Text="Storage Efficiency:" FontWeight="Bold" Margin="0,0,10,5"/>
                                            <TextBlock Grid.Row="2" Grid.Column="1" x:Name="StorageEfficiencyTextBlock" Text="-" Margin="0,0,0,5"/>
                                        </Grid>
                                    </Grid>
                                </TabItem>
                                
                                <!-- SQL Tab -->
                                <TabItem Header="SQL Script">
                                    <Border BorderBrush="#DDDDDD" BorderThickness="1" Margin="0,10,0,0">
                                        <TextBox x:Name="SqlScriptTextBox" AcceptsReturn="True" TextWrapping="Wrap"
                                                 FontFamily="Consolas" FontSize="12" IsReadOnly="True"
                                                 VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto"
                                                 MinHeight="300"/>
                                    </Border>
                                </TabItem>
                            </TabControl>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>
            </Grid>
        </Grid>
    </Grid>
</Window>